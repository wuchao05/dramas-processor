# 飞书群通知功能使用说明

## 功能概述

本项目新增了飞书群通知功能，可以在剪辑任务开始和完成时自动发送通知到飞书群，方便实时了解处理进度。

## 功能特点

- **开始通知**：在开始批量剪辑时发送通知，包含待处理剧目列表、日期、状态等信息
- **完成通知**：在所有剧目处理完成后发送通知，包含处理结果、素材统计、耗时等信息
- **错误通知**：在处理过程中遇到异常时发送错误通知
- **防抖机制**：内置请求防抖，避免过于频繁的通知

## 配置方式

### 1. 通过命令行参数

```bash
# 使用自定义webhook地址
python -m drama_processor process --feishu-webhook "https://your-webhook-url"

# 禁用飞书通知
python -m drama_processor process --no-feishu-notification
```

### 2. 通过配置文件

在配置文件中添加以下字段：

```yaml
# 飞书通知配置
enable_feishu_features: true  # 全局开关，关闭后所有飞书相关能力失效
feishu_webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/6d2e64c2-a5b4-4f2e-b518-a8e314c4c355"
enable_feishu_notification: true
```

> 提示：如果 `enable_feishu_features` 设置为 `false`，所有飞书相关能力（包括表格同步与群机器人通知）都会被跳过，即使单独开启通知或配置了 API 参数也不会生效。

## 通知内容示例

### 开始剪辑通知

```
🎬 开始批量剪辑通知

📅 开始时间: 2025-01-09 14:30:00
📊 本次处理: 3 部短剧
📋 每部生成: 10 条素材
⏱️ 时长范围: 480~900秒

📝 待处理剧目:
1. 短剧名称1 (日期: 9.5, 状态: 待剪辑)
2. 短剧名称2 (日期: 9.5, 状态: 待剪辑)
3. 短剧名称3 (日期: 9.5, 状态: 待剪辑)

🔄 处理中，请稍候...
```

### 完成剪辑通知

```
🎉 批量剪辑完成通知

📅 完成时间: 2025-01-09 16:45:00
⏱️ 总耗时: 2.3 小时
📊 处理结果: 28/30 条素材生成成功
📈 成功率: 93.3%

✅ 成功处理 (2 部):
1. ✅ 短剧名称1 (10/10条, 日期: 9.5)
2. ⚠️ 短剧名称2 (8/10条, 日期: 9.5)

❌ 处理失败 (1 部):
1. ❌ 短剧名称3 (日期: 9.5)

📤 提醒: 请及时上传已完成的素材到相应平台！
```

## 使用场景

1. **无人值守剪辑**：启动长时间的批量剪辑任务后，通过飞书通知及时了解进度
2. **团队协作**：多人协作时，通过群通知让团队成员了解任务状态
3. **异常监控**：及时发现和处理剪辑过程中的异常情况

## 技术实现

- 使用飞书机器人 webhook API 发送群消息
- 支持文本格式消息，包含 emoji 和格式化文本
- 内置防抖机制，避免过于频繁的请求
- 异常处理机制，通知失败不会影响主要剪辑流程

## 注意事项

1. 需要先在飞书群中添加机器人并获取 webhook 地址
2. 网络连接异常时通知可能失败，但不会影响剪辑任务本身
3. 通知内容会根据实际处理结果动态生成
4. 建议在测试环境中先验证通知功能是否正常

## 常见问题

**Q: 如何获取飞书 webhook 地址？**
A: 在飞书群中添加自定义机器人，系统会生成一个 webhook 地址。

**Q: 通知发送失败怎么办？**
A: 通知失败不会影响剪辑任务，可以检查网络连接和 webhook 地址是否正确。

**Q: 可以自定义通知内容吗？**
A: 目前通知内容是固定格式，后续版本可能会支持自定义模板。

**Q: 支持其他通知方式吗？**
A: 当前只支持飞书，后续可能会增加微信、钉钉等其他通知方式。
